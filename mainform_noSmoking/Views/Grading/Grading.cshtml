@using Microsoft.AspNetCore.Mvc.Rendering
@using mainform_noSmoking.Models.Grading

@model mainform_noSmoking.Models.Grading.GradingModel
@{
    Layout = "";
}
<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <!--數字與地圖不被設置為預設電話與地圖-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="format-detection" content="telephone=no">
    <link rel="shortcut icon" href="http://www.e-quit.org/images/jtf_logo.ico">
    <title>2022我拒菸我驕傲後台審核系統</title>
    <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link href="~/css/pending_system.css" rel="stylesheet" />
</head>

<body>
    <div class="sidebar">
        <div class="logo-details">
            <span class="logo_name">
                臺北市國小學童拒菸作品<br />後台審核系統
            </span>
        </div>
        <ul class="nav-links">
            <li>
                <a name="Alles">
                    <svg xmlns="http://www.w3.org/2000/svg" width="25.271" height="22.112" viewBox="0 0 25.271 22.112">
                        <path id="Icon_awesome-archive" data-name="Icon awesome-archive" d="M1.579,22.782a1.578,1.578,0,0,0,1.579,1.579H22.112a1.578,1.578,0,0,0,1.579-1.579V8.568H1.579Zm7.9-10.464a.594.594,0,0,1,.592-.592H15.2a.594.594,0,0,1,.592.592v.395a.594.594,0,0,1-.592.592H10.069a.594.594,0,0,1-.592-.592ZM23.691,2.25H1.579A1.578,1.578,0,0,0,0,3.829V6.2a.792.792,0,0,0,.79.79H24.481a.792.792,0,0,0,.79-.79V3.829A1.578,1.578,0,0,0,23.691,2.25Z" transform="translate(0 -2.25)" fill="#fff" />
                    </svg>
                    <span class="links_name">所有作品</span>
                </a>
            </li>
            <li>
                <a class="active" name="Pending">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16.086" height="26.255" viewBox="0 0 16.086 26.255">
                        <path id="Icon_awesome-hourglass-half" data-name="Icon awesome-hourglass-half" d="M15.08,0H1.005A1.135,1.135,0,0,0,0,1.231v.82A1.135,1.135,0,0,0,1.005,3.282c0,4.665,2.137,8.6,5.062,9.845-2.925,1.244-5.062,5.181-5.062,9.845A1.135,1.135,0,0,0,0,24.2v.82a1.135,1.135,0,0,0,1.005,1.231H15.08a1.135,1.135,0,0,0,1.005-1.231V24.2a1.135,1.135,0,0,0-1.005-1.231c0-4.665-2.137-8.6-5.062-9.845,2.925-1.244,5.062-5.181,5.062-9.845a1.135,1.135,0,0,0,1.005-1.231v-.82A1.135,1.135,0,0,0,15.08,0ZM11.935,19.691H4.15c.715-2.4,2.182-4.1,3.892-4.1S11.221,17.291,11.935,19.691Zm0-13.127H4.15a11.575,11.575,0,0,1-.464-3.282H12.4a11.577,11.577,0,0,1-.463,3.282Z" fill="#fff" />
                    </svg>
                    <span class="links_name">待審核</span>
                </a>
            </li>
            <li>
                <a name="UnPasses">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22.112" height="22.112" viewBox="0 0 22.112 22.112">
                        <path id="Icon_metro-cross" data-name="Icon metro-cross" d="M24.481,19.692h0l-6.708-6.708,6.708-6.708h0a.693.693,0,0,0,0-.977L21.312,2.13a.693.693,0,0,0-.977,0h0L13.627,8.838,6.919,2.13h0a.693.693,0,0,0-.977,0L2.773,5.3a.693.693,0,0,0,0,.977h0l6.708,6.708L2.773,19.692h0a.692.692,0,0,0,0,.977l3.169,3.169a.693.693,0,0,0,.977,0h0l6.708-6.708,6.708,6.708h0a.692.692,0,0,0,.977,0l3.169-3.169a.692.692,0,0,0,0-.977Z" transform="translate(-2.571 -1.928)" fill="#fff" />
                    </svg>
                    <span class="links_name">未通過</span>
                </a>
            </li>
            <!--li class="log_out">
                <a href="#">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28.932" height="25.316" viewBox="0 0 28.932 25.316">
                        <path id="Icon_open-account-logout" data-name="Icon open-account-logout" d="M10.85,0V3.617H25.316V21.7H10.85v3.617H28.932V0ZM7.233,7.233,0,12.658l7.233,5.425V14.466H21.7V10.85H7.233Z" fill="#fff" />
                    </svg>
                    <span class="links_name">登出</span>
                </a>
            </li-->
        </ul>
    </div>
    <section class="home-section">
        <nav>
            <div class="sidebar-button">
                <i class='bx bx-menu sidebarBtn'></i>
                <span class="dashboard">控制台</span>
            </div>
        </nav>

        <div class="home-content">
            <div class="sales-boxes">
                <div class="recent-sales box">
                    <form method="post">
                        <div class="upper_title">
                            <div class="title" id="title_name">待審核作品</div>
                            <button class="button-54" type="submit" asp-controller="Grading" asp-action="GetReport">下載下列資料為Excel</button>
                        </div>
                        <input name="Status" value="0" hidden>
                        <div class="sales-details">
                            <!--GradingTable-->
                            <div id="partialGrading">
                                @await Html.PartialAsync("_GradingPartial", Model)
                            </div>
                            <!--GradingTable-->
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>


    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>

    <script>
        let sidebar = document.querySelector(".sidebar");
        let sidebarBtn = document.querySelector(".sidebarBtn");
        sidebarBtn.onclick = function () {
            sidebar.classList.toggle("active");
            if (sidebar.classList.contains("active")) {
                sidebarBtn.classList.replace("bx-menu", "bx-menu-alt-right");
            } else
                sidebarBtn.classList.replace("bx-menu-alt-right", "bx-menu");
        }
    </script>

    <script>
        var status = 0
        //show ...
        $(document).on("click", 'a[name="Alles"]', function () {
            var grade = $('select[name="Student_grade"]').val();
            $('input[name="Status"]').val(3);
            $.ajax({
                url: "/Grading/GetGradeWorks/" + grade + "/" + 3,
                dataType: "html",
                type: "get",
                success: function (data) {
                    status = 3
                    $('#partialGrading').html(data);
                    $('select[name="Student_grade"]').val(grade);
                    $('#title_name').text("所有作品");
                },
                error: function () { alert('Error occurred in show info by grade.'); }
            })
        })
        //show
    </script>

    <script>
        //show ...
        $(document).on("click", 'a[name="Pending"]', function () {
            var grade = $('select[name="Student_grade"]').val();
            $('input[name="Status"]').val(0);
            $.ajax({
                url: "/Grading/GetGradeWorks/" + grade + "/" + 0,
                dataType: "html",
                type: "get",
                success: function (data) {
                    status = 0
                    $('#partialGrading').html(data);
                    $('select[name="Student_grade"]').val(grade);
                    $('#title_name').text("待審核作品");
                },
                error: function () { alert('Error occurred in show info by grade.'); }
            })
        })
        //show
    </script>

    <script>
        //show ...
        $(document).on("click", 'a[name="UnPasses"]', function () {
            var grade = $('select[name="Student_grade"]').val();
            $('input[name="Status"]').val(2);
            $.ajax({
                url: "/Grading/GetGradeWorks/" + grade + "/" + 2,
                dataType: "html",
                type: "get",
                success: function (data) {
                    status = 2
                    $('#partialGrading').html(data);
                    $('select[name="Student_grade"]').val(grade);
                    $('#title_name').text("未通過作品");
                },
                error: function () { alert('Error occurred in show info by grade.'); }
            })
        })
        //show
    </script>

    <script>
        //show grading modal
        $(document).on("click", 'tr[name="StudentAndWork"]', function () {
            $.ajax({
                url: "/Grading/GetWork/" + $(this).attr("id"),
                dataType: "html",
                type: "get",
                success: function (result) {
                    $("#GradingModal").modal("show");
                    $("#parialGrading").html(result);
                    var alles = document.querySelector('a[name="Alles"]');
                    var pending = document.querySelector('a[name="Pending"]');
                    var unPasses = document.querySelector('a[name="UnPasses"]');

                    if (alles.classList.contains("active"))
                        $("#nopapa").attr("style", "display: none");
                    else if (pending.classList.contains("active") || unPasses.classList.contains("active"))
                        $("#nopapa").attr("style", "display: null");
                },
                error: function () { alert('Error occurred in get work.'); }
            })
        })
        //show grading modal
    </script>

    <script>
        //work pass
        $(document).on("click", 'p[name="Pass"]', function () {
            var student_id = $('#Student_id').attr("name");
            $.ajax({
                url: "/Grading/Pass/" + student_id + "/1",
                type: "get",
                success: function () {
                    $("#GradingModal").modal("hide");
                    $("#" + student_id).remove();
                }
            })
        })
        //work pass

        //work repending
        $(document).on("click", 'p[name="ToPending"]', function () {
            var student_id = $('#Student_id').attr("name");
            $.ajax({
                url: "/Grading/Pass/" + student_id + "/0",
                type: "get",
                success: function () {
                    $("#GradingModal").modal("hide");
                    if (document.querySelector('a[name="Pending"]').classList.contains("active") == false) {
                        $("#" + student_id).remove();
                    }
                }
            })
        })
        //work repending

        //work reject
        $(document).on("click", 'p[name="Reject"]', function () {
            var student_id = $('#Student_id').attr("name");
            $.ajax({
                url: "/Grading/Pass/" + student_id + "/2",
                type: "get",
                success: function () {
                    $("#GradingModal").modal("hide");
                    if (document.querySelector('a[name="UnPasses"]').classList.contains("active") == false) {
                        $("#" + student_id).remove();
                    }
                }
            })
        })
        //work reject
    </script>

    <script>
        //show infos in selected grade
        $(document).on('change', 'select[name="Student_grade"]', function () {
            var grade = $('select[name="Student_grade"]').val();
            $.ajax({
                url: "/Grading/GetGradeWorks/" + grade + "/" + status,
                dataType: "html",
                type: "get",
                success: function (data) {
                    $('#partialGrading').html(data);
                    $('select[name="Student_grade"]').val(grade);
                },
                error: function () { alert('Error occurred in show info by grade.'); }
            })
        });
        //show infos in selected grade
    </script>

    <script>
        //color change
        $('.nav-links li a').on('click', function () {
            $('.nav-links li a').removeClass('active');
            $(this).addClass('active');
        })
    </script>
</body>
</html>

@*grading modal*@
<div class="modal" id="GradingModal">
    <div class="modal-content">
        <div id="parialGrading">
            @await Html.PartialAsync("_GradingModalPartial", Model)
        </div>
    </div>
</div>
@*grading modal*@